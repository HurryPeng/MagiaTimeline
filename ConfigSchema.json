{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "$id": "https://magiatimeline.tech/schemas/ConfigSchema.json",
    "title": "MagiaTimeline configuration schema",
    "$defs": {
        "ratio": {
            "description": "a nuber between 0 and 1 representing a relative width or height in a frame",
            "type": "number",
            "minimum": 0,
            "maximum": 1
        },
        "ratioRectangle": {
            "description": "a rectangular area in a frame described by ratios of [left, right, top, bottom]",
            "type": "array",
            "items": [
                {
                    "$ref": "#/$defs/ratio"
                },
                {
                    "$ref": "#/$defs/ratio"
                },
                {
                    "$ref": "#/$defs/ratio"
                },
                {
                    "$ref": "#/$defs/ratio"
                }
            ],
            "minItems": 4,
            "maxItems": 4,
            "additionalItems": false
        }
    },
    "type": "object",
    "properties": {
        "source": {
            "description": "paths of source video files",
            "type": "array",
            "items": {
                "type": "string"
            },
            "minLength": 1
        },
        "destination": {
            "description": "paths of destination ass subtitle files",
            "type": "array",
            "items": {
                "type": "string"
            },
            "minLength": 1
        },
        "assTemplate": {
            "description": "template ass file defining the header of destination ass file, in asst format",
            "type": "string"
        },
        "enableOpenCL": {
            "description": "enable OpenCL acceleration",
            "type": "boolean"
        },
        "contentRect": {
            "description": "defines the rectangle that wraps the content of a frame, cutting away black bars around",
            "$ref": "#/$defs/ratioRectangle"
        },
        "strategy": {
            "description": "which algorithm to use for timing",
            "enum": [
                "mr",
                "mr-s0",
                "lcb",
                "lcb-mech",
                "pkm",
                "prk",
                "bdr",
                "otl",
                "bcs"
            ]
        },
        "preset": {
            "description": "which preset of parameters under a strategy to use for timing",
            "type": "string"
        },
        "mr": {
            "description": "MagiaRecord quest video strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy mr",
                    "type": "object",
                    "properties": {
                        "dialogOutlineRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "dialogBgRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "blackscreenRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "whitescreenRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "cgSubAboveRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "cgSubBorderRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "cgSubBelowRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "cgSubTextRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogOutlineRect",
                        "dialogBgRect",
                        "blackscreenRect",
                        "whitescreenRect",
                        "cgSubAboveRect",
                        "cgSubBorderRect",
                        "cgSubBelowRect",
                        "cgSubTextRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "mr-s0": {
            "description": "MagiaRecord Scene0 film strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy mr",
                    "type": "object",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "blackscreenRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogRect",
                        "blackscreenRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "lcb": {
            "description": "LimbusCompany quest video strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "type": "object",
                    "description": "a preset for strategy lcb",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "lcb-mech": {
            "description": "LimbusCompany mechanics introduction video strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "type": "object",
                    "description": "a preset for strategy lcb-mech",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "pkm": {
            "description": "PekemonEmerald strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy pkm",
                    "type": "object",
                    "properties": {
                        "dialogBgRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogBgRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "prk": {
            "description": "Parako strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy prk",
                    "type": "object",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "bdr": {
            "description": "BanG Dream strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy bdr",
                    "type": "object",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        }
                    },
                    "required": [
                        "dialogRect"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "otl": {
            "description": "Outline strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy otl",
                    "type": "object",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "fastMode": {
                            "type": "boolean"
                        },
                        "textWeightMin": {
                            "type": "integer"
                        },
                        "textWeightMax": {
                            "type": "integer"
                        },
                        "textHSVRanges": {
                            "type": "array",
                            "items": {
                                "type": "array",
                                "items": {
                                    "type": "integer"
                                },
                                "minItems": 6,
                                "maxItems": 6
                            }
                        },
                        "outlineWeightMax": {
                            "type": "integer"
                        },
                        "outlineHSVRanges": {
                            "type": "array",
                            "items": {
                                "type": "array",
                                "items": {
                                    "type": "integer"
                                },
                                "minItems": 6,
                                "maxItems": 6
                            }
                        },
                        "boundCompensation": {
                            "type": "integer"
                        },
                        "sobelThreshold": {
                            "type": "integer"
                        },
                        "nestingSuppression": {
                            "type": "integer"
                        },
                        "featureThreshold": {
                            "type": "number"
                        },
                        "featureJumpThreshold": {
                            "type": "number"
                        },
                        "featureJumpStddevThreshold": {
                            "type": "number"
                        },
                        "debugLevel": {
                            "type": "integer",
                            "minimum": 0,
                            "maximum": 3
                        }
                    },
                    "required": [
                        "dialogRect",
                        "fastMode",
                        "textWeightMin",
                        "textWeightMax",
                        "textHSVRanges",
                        "outlineWeightMax",
                        "outlineHSVRanges",
                        "boundCompensation",
                        "sobelThreshold",
                        "nestingSuppression",
                        "featureThreshold",
                        "featureJumpThreshold",
                        "featureJumpStddevThreshold",
                        "debugLevel"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "bcs": {
            "description": "Box colour stat strategy",
            "type": "object",
            "patternProperties": {
                ".*": {
                    "description": "a preset for strategy bcs",
                    "type": "object",
                    "properties": {
                        "dialogRect": {
                            "$ref": "#/$defs/ratioRectangle"
                        },
                        "sobelThreshold": {
                            "type": "integer"
                        },
                        "featureThreshold": {
                            "type": "number",
                            "minimum": 0
                        },
                        "featureJumpThreshold": {
                            "type": "number",
                            "minimum": 0
                        },
                        "featureJumpStddevThreshold": {
                            "type": "number",
                            "minimum": 0
                        },
                        "boxVerticalExpansion": {
                            "type": "number",
                            "minimum": 0
                        },
                        "nonMajorBoxSuppressionMaxRatio": {
                            "type": "number",
                            "minimum": 0
                        },
                        "nonMajorBoxSuppressionMinRank": {
                            "type": "integer",
                            "minimum": 1
                        },
                        "minCcAreaRatio": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        },
                        "maxCcAreaRatio": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        },
                        "minCcFinalMean": {
                            "type": "number",
                            "minimum": 0
                        },
                        "maxCcStddev": {
                            "type": "number",
                            "minimum": 0
                        },
                        "colourTolerance": {
                            "type": "number",
                            "minimum": 0
                        },
                        "clusterThreshold": {
                            "type": "number",
                            "minimum": 0
                        },
                        "minColourAreaRatio": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        },
                        "maxGreyscalePenalty": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        },
                        "iirPassDenoiseMinTime": {
                            "type": "integer",
                            "minimum": 0
                        },
                        "debugLevel": {
                            "type": "number",
                            "minimum": 0,
                            "maximum": 1
                        }
                    },
                    "required": [
                        "dialogRect",
                        "sobelThreshold",
                        "featureThreshold",
                        "featureJumpThreshold",
                        "featureJumpStddevThreshold",
                        "minCcAreaRatio",
                        "maxCcAreaRatio",
                        "minCcFinalMean",
                        "maxCcStddev",
                        "colourTolerance",
                        "clusterThreshold",
                        "minColourAreaRatio",
                        "maxGreyscalePenalty",
                        "iirPassDenoiseMinTime",
                        "debugLevel"
                    ],
                    "additionalProperties": false
                }
            }
        },
        "engine": {
            "description": "which sampling pipeline to use",
            "type": "string",
            "enum": [
                "framewise",
                "speculative"
            ]
        },
        "framewise": {
            "description": "Parameters for the framewise engine",
            "type": "object",
            "properties": {
                "sampleInterval": {
                    "description": "in how many frames to sample a frame",
                    "type": "integer",
                    "minimum": 1
                },
                "debug": {
                    "description": "enable debug mode",
                    "type": "boolean"
                }, 
                "debugPyrDown" : {
                    "type": "number",
                    "minimum": 0
                }
            },
            "required": [
                "sampleInterval",
                "debug"
            ],
            "additionalProperties": false
        },
        "speculative": {
            "description": "Parameters for the speculative engine",
            "type": "object",
            "properties": {
                "emptyGapForceCheck": {
                    "description": "In how many milliseconds to force check for existence of subtitles (0 to disable)",
                    "type": "number",
                    "minimum": 0
                },
                "debug": {
                    "description": "enable debug mode",
                    "type": "boolean"
                }
            },
            "required": [
                "emptyGapForceCheck",
                "debug"
            ],
            "additionalProperties": false
        },
        "extraJobs": {
            "description": "List of extra jobs to perform after subtitle extraction",
            "type": "array",
            "items": {
                "type": "string"
            }
        },
        "ocr": {
            "type": "object",
            "properties": {
                "suffix": {
                    "type": "string"
                },
                "separator": {
                    "type": "string"
                },
                "doPaddle": {
                    "type": "boolean"
                },
                "paddleLang": {
                    "type": "string"
                },
                "doTesseract": {
                    "type": "boolean"
                },
                "tesseractLang": {
                    "type": "string"
                }
            },
            "required": [
                "suffix",
                "separator",
                "doPaddle",
                "paddleLang",
                "doTesseract",
                "tesseractLang"
            ],
            "additionalProperties": false
        }
    },
    "required": [
        "source",
        "destination",
        "assTemplate",
        "contentRect",
        "strategy",
        "preset",
        "engine",
        "framewise",
        "speculative",
        "extraJobs"
    ],
    "additionalProperties": false
}